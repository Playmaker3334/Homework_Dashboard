<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Realtime Global Earthquakes ‚Ä¢ USGS Feed</title>

<!-- ‚îÄ‚îÄ DARK THEME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<style>
:root{
  --bg:#0e0e11;--panel:#1a1a1f;--text:#e6e6e9;
  --accent:#9b5de5;--grid:rgba(255,255,255,.07);--font:"Inter",system-ui,sans-serif
}
@media(prefers-color-scheme:light){
  :root{--bg:#fafafa;--panel:#fff;--text:#1a1a1f;--grid:rgba(0,0,0,.08)}
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  display:flex;align-items:center;justify-content:center;
  background:var(--bg);color:var(--text);font-family:var(--font)
}
#chart-wrapper{
  width:95%;max-width:1100px;background:var(--panel);
  padding:1.8rem 2rem;border-radius:18px;
  box-shadow:0 0 45px rgba(0,0,0,.45)
}
h1{font-size:1.35rem;font-weight:600;margin-bottom:.4rem}
p#sub{font-size:.85rem;opacity:.7;margin-bottom:1rem}
canvas{width:100%!important;height:65vh!important}
#updated{font-size:.75rem;opacity:.6;margin-top:.8rem;text-align:right}
</style>
</head>
<body>
<div id="chart-wrapper">
  <h1>üåç Global Earthquakes ‚Äì Magnitude vs Time</h1>
  <p id="sub">Datos de <a href="https://earthquake.usgs.gov/" target="_blank" style="color:var(--accent)">USGS</a> (se actualiza tan pronto haya un sismo nuevo)</p>
  <canvas id="eq-chart"></canvas>
  <div id="updated">√öltima actualizaci√≥n: ‚Äî</div>
</div>

<!-- ‚îÄ‚îÄ LIBRER√çAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0"></script>

<!-- ‚îÄ‚îÄ JS L√ìGICA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<script>
const USGS_URL  = 'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson';
const POLL_MS   = 1000;         // 1 segundo
const MAX_PTS   = 120;          // m√°x. 120 eventos (~1 h)
const seenIds   = new Set();
const updatedEl = document.getElementById('updated');

// Colores desde CSS custom properties
const getVar = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();

// Chart setup
const ctx = document.getElementById('eq-chart').getContext('2d');
const data = {
  labels: [],
  datasets:[{
    label:'Magnitude',
    data:[],
    borderColor:getVar('--accent'),
    backgroundColor:'rgba(0,0,0,0)',
    pointRadius:3,
    pointBackgroundColor:getVar('--accent'),
    borderWidth:2,
    tension:.25
  }]
};

const chart = new Chart(ctx,{
  type:'line',
  data,
  options:{
    scales:{
      x:{
        type:'timeseries',
        time:{displayFormats:{second:'HH:mm:ss'}},
        grid:{color:getVar('--grid')},
        title:{display:true,text:'UTC Time'}
      },
      y:{
        beginAtZero:true,
        grid:{color:getVar('--grid')},
        title:{display:true,text:'Magnitude'}
      }
    },
    animation:{duration:0},
    plugins:{
      legend:{display:false},
      tooltip:{
        backgroundColor:'rgba(30,30,35,.92)',
        borderColor:getVar('--accent'),borderWidth:1,
        callbacks:{
          title: ctx => new Date(ctx[0].parsed.x).toUTCString(),
          label: ctx => `Mag ${ctx.parsed.y}`
        }
      }
    },
    responsive:true,maintainAspectRatio:false
  }
});

// Actualiza gr√°fico con un nuevo sismo
function addPoint({id,time,mag}){
  if(seenIds.has(id)) return;
  seenIds.add(id);

  data.labels.push(time);
  data.datasets[0].data.push(mag);

  if(data.labels.length>MAX_PTS){
    data.labels.shift();
    data.datasets[0].data.shift();
  }
  chart.update();
}

// Fetch a USGS batch
async function fetchQuakes(){
  try{
    const res  = await fetch(USGS_URL);
    const geo  = await res.json();
    geo.features.forEach(f=>{
      addPoint({
        id:  f.id,
        time:new Date(f.properties.time),
        mag: f.properties.mag
      });
    });
    updatedEl.textContent = '√öltima actualizaci√≥n: ' +
        new Date().toLocaleTimeString('es-MX',{hour12:false});
  }catch(err){console.error('Fetch error',err)}
}

// Arranque
fetchQuakes();
setInterval(fetchQuakes,POLL_MS);
</script>
</body>
</html>
